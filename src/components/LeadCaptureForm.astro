---
interface Props {
  segmentId: string;
  title?: string;
  description?: string;
  buttonText?: string;
  showName?: boolean;
  showPhone?: boolean;
  variant?: 'default' | 'inline' | 'card';
  class?: string;
}

const {
  segmentId,
  title,
  description,
  buttonText = 'Cadastrar',
  showName = true,
  showPhone = true,
  variant = 'default',
  class: className = '',
} = Astro.props;

const formId = `lead-form-${segmentId}-${Math.random().toString(36).substr(2, 9)}`;
---

<div class:list={['lead-capture-form', className]} data-form-wrapper={formId}>
  {title && (
    <h3 class="font-bold text-lg text-secondary-500 mb-2">{title}</h3>
  )}
  {description && (
    <p class="text-secondary-400 text-sm mb-4">{description}</p>
  )}

  <form
    method="POST"
    action="/"
    data-rptn-form={segmentId}
    class="space-y-3"
    id={formId}
  >
    {showName && (
      <input
        data-rptn-field="name"
        type="text"
        name="name"
        placeholder="Seu nome"
        required
        class="w-full px-4 py-3 border border-secondary-200 rounded-lg bg-white text-secondary-500 placeholder:text-secondary-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 outline-none transition"
      />
    )}

    <input
      data-rptn-field="email"
      type="email"
      name="email"
      placeholder="Digite seu melhor e-mail"
      required
      class="w-full px-4 py-3 border border-secondary-200 rounded-lg bg-white text-secondary-500 placeholder:text-secondary-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 outline-none transition"
    />

    {showPhone && (
      <input
        data-rptn-field="phone"
        type="tel"
        name="phone"
        placeholder="WhatsApp (opcional)"
        class="w-full px-4 py-3 border border-secondary-200 rounded-lg bg-white text-secondary-500 placeholder:text-secondary-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 outline-none transition"
      />
    )}

    <button
      type="submit"
      class="w-full bg-primary-500 text-secondary-500 py-3 px-4 rounded-lg font-semibold hover:bg-primary-400 transition-colors"
    >
      {buttonText}
    </button>

    <p class="text-xs text-secondary-400 text-center">
      Ao se cadastrar, vocÃª concorda com nossa{' '}
      <a href="https://modopag.com.br/privacidade" class="underline hover:text-secondary-500 transition-colors">
        PolÃ­tica de Privacidade
      </a>
    </p>
  </form>

  <!-- Success message (hidden by default) -->
  <div class="success-message hidden text-center p-6 bg-green-50 rounded-lg">
    <div class="text-3xl mb-2">ðŸŽ‰</div>
    <h3 class="text-green-800 font-semibold">Cadastro realizado!</h3>
    <p class="text-green-600 text-sm mt-2">
      VocÃª receberÃ¡ nossas novidades em breve.
    </p>
  </div>
</div>

<script define:vars={{ formId }}>
  function initLeadForm() {
    const wrapper = document.querySelector(`[data-form-wrapper="${formId}"]`);
    if (!wrapper) return;

    const form = wrapper.querySelector('form');
    const successMessage = wrapper.querySelector('.success-message');

    if (!form || !successMessage) return;

    form.addEventListener('submit', (e) => {
      // Let Reportana handle the submission
      // Show success message after a short delay
      setTimeout(() => {
        form.classList.add('hidden');
        successMessage.classList.remove('hidden');
      }, 500);
    });
  }

  // Initialize on page load
  initLeadForm();

  // Re-initialize after Astro page transitions
  document.addEventListener('astro:after-swap', initLeadForm);
</script>
